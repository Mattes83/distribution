version: "3.7"
services:
  registry:
    build:
      context: .
      dockerfile: Dockerfile
    command: "serve /registry/serverconf/config.yml"
    volumes:
      - /Users/manish/stuff/registry/data:/var/lib/registry
      - ./torrent-conf.yml:/registry/serverconf/config.yml
    ports:
      - "5000:5000"
      - "5001:5001"
      - "42069/udp"
    depends_on:
      - tracker
  tracker:
    image: lednerb/opentracker-docker
    ports:
      - "6969"
  engine1:
    build:
      context: .
      dockerfile: Dockerfile.engine
    environment:
      REGISTRY_URL: http://registry:5000
      DATA_DIR: /root/engine/
    ports:
      - "80"
    depends_on:
      - registry
      - tracker
  client1:
    image: curlimages/curl
    command: curl engine1/repos/alpine/tags/latest/pull
    #entrypoint: sh
    depends_on:
      - engine1
  peer:
    build:
      context: .
      dockerfile: Dockerfile.torrent
    command: /go/download.sh
    entrypoint: sh
    depends_on:
      - registry
      - tracker